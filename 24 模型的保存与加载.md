# `API`及语法

`sklearn.externals.joblib`

1.保存：`joblib.dump(rf,'test.pkl')`

2.加载：`estimator = joblib.load('test.pkl')`

**注**：文件格式是pkl格式

# 波士顿房价岭回归预测模型保存及调用的案例

**代码**：

```python
# 带有正则化的线性回归（岭回归）API
from sklearn.linear_model import Ridge
# 加载波士顿房价数据集
from sklearn.datasets import load_boston
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
# 导入均方误差API
from sklearn.metrics import mean_squared_error
# 导入保存和加载API
from sklearn.externals import joblib
def mylinear():
    """
    岭回归训练预测房价模型，保存模型，并应用保存的模型进行预测
    :return: None
    """
    # 获取数据
    lb = load_boston()
    # 分割数据集
    x_train, x_test, y_train,y_test = train_test_split(lb.data, lb.target, test_size=0.25)
    # 进行标准化处理
    # 特征值与目标值都需要进行标准化处理
    std_x = StandardScaler()
    x_train = std_x.fit_transform(x_train)
    x_test = std_x.transform(x_test)
    std_y = StandardScaler()
    y_train = std_y.fit_transform(y_train.reshape(-1,1))
    """标准化处理注意转化数据集的形状，其要求必须是二维数组
    Reshape your data either using array.reshape(-1, 1) if your data has a single feature 
    or array.reshape(1, -1) if it contains a single sample."""
    y_test = std_y.transform(y_test.reshape(-1,1))
    print(std_y.inverse_transform(y_test))
    # 估计器进行预测
    # 岭回归求权重进行预测
    rd = Ridge(alpha=1.0)
    rd.fit(x_train, y_train)
    print("训练得到的参数：", '\n', rd.coef_)
    # 保存训练好的模型
    joblib.dump(rd, "./datasets/岭回归预测房价.pkl")
    # 调用已保存的模型
    estimator = joblib.load("./datasets/岭回归预测房价.pkl")
    y_predict = std_y.inverse_transform(estimator.predict(x_test))
    "inverse_transform可以将y_predict还原为标准化前的结果"
    print("模型预测房价结果：", '\n', y_predict)

    # 均方误差机制评估回归性能
    print("岭回归误差：", mean_squared_error(std_y.inverse_transform(y_test), y_predict))
    return None


if __name__ == "__main__":
    mylinear()
```

**运行结果**：

```python
[[12.7]
 [17.4]
 [22.6]
 [17.2]
 [33.8]
 [13. ]
 [19.7]
 [20.6]
 [21.2]
 [50. ]
 [18.6]
 [15.3]
 [13.8]
 [20.4]
 [27.9]
 [14.1]
 [16.8]
 [24.5]
 [20. ]
 [42.8]
 [20.1]
 [27.5]
 [28.7]
 [17.8]
 [23.3]
 [26.6]
 [18.3]
 [15.6]
 [ 5. ]
 [14.9]
 [11.8]
 [32. ]
 [21. ]
 [25.2]
 [36.5]
 [18.7]
 [19.5]
 [31.1]
 [20.6]
 [22.8]
 [33.1]
 [18.9]
 [29.8]
 [20.6]
 [24.4]
 [31.5]
 [22. ]
 [27.5]
 [15. ]
 [19.3]
 [27.5]
 [22.3]
 [ 7.5]
 [37.3]
 [35.4]
 [50. ]
 [18.5]
 [19.8]
 [33. ]
 [50. ]
 [37.6]
 [50. ]
 [20. ]
 [26.6]
 [23.9]
 [19.4]
 [ 8.1]
 [44. ]
 [24.4]
 [17.2]
 [13.4]
 [23.1]
 [50. ]
 [14.5]
 [15.2]
 [28. ]
 [27. ]
 [24.8]
 [24.7]
 [24.6]
 [32. ]
 [18.5]
 [19.3]
 [11.3]
 [31.2]
 [50. ]
 [19.1]
 [19.6]
 [23.1]
 [20.2]
 [11. ]
 [22.8]
 [20.3]
 [25. ]
 [22. ]
 [24.8]
 [29.6]
 [18.6]
 [24.3]
 [36.1]
 [21.7]
 [21.4]
 [25. ]
 [34.9]
 [31. ]
 [17.8]
 [34.9]
 [22.5]
 [ 8.4]
 [20.5]
 [23.6]
 [15.6]
 [10.2]
 [21.2]
 [17.8]
 [15.6]
 [24.3]
 [13.8]
 [11.9]
 [18.4]
 [30.1]
 [26.5]
 [46.7]
 [ 7. ]
 [32.4]
 [22.9]
 [22.7]]
训练得到的参数： 
 [[-0.09535495  0.09146849 -0.019786    0.07311611 -0.26680685  0.22255595
   0.02515601 -0.38548466  0.25750707 -0.18621267 -0.25396311  0.07590655
  -0.45035854]]
模型预测房价结果： 
 [[17.9455454 ]
 [17.61866072]
 [27.8408165 ]
 [14.64562566]
 [34.91000737]
 [16.6119839 ]
 [20.94887066]
 [19.00467452]
 [21.30191697]
 [42.4357029 ]
 [20.77134544]
 [20.99146274]
 [19.95221877]
 [22.9791173 ]
 [30.91993837]
 [18.5559729 ]
 [19.9401692 ]
 [20.3506546 ]
 [23.39777751]
 [27.06848186]
 [18.74230294]
 [19.73462387]
 [31.07073556]
 [ 9.91827455]
 [25.45155651]
 [20.79193929]
 [19.64435002]
 [15.71253076]
 [ 8.76955025]
 [14.82337249]
 [11.5300811 ]
 [33.86332968]
 [21.3519974 ]
 [26.9905477 ]
 [36.12042376]
 [21.37787394]
 [19.46455618]
 [31.52519289]
 [14.81576211]
 [28.91860529]
 [32.14885994]
 [21.63186396]
 [24.67424276]
 [21.15445471]
 [23.17758433]
 [32.33031635]
 [28.29516563]
 [16.52811273]
 [17.06446007]
 [22.50067975]
 [24.73822338]
 [27.30251196]
 [12.84284971]
 [33.1294089 ]
 [28.89832003]
 [39.58840701]
 [19.87248792]
 [22.15722837]
 [21.83816721]
 [43.19029242]
 [37.05990577]
 [34.45605217]
 [17.60253923]
 [27.33781712]
 [27.18183837]
 [23.23405983]
 [ 4.64268337]
 [36.15688923]
 [28.45932766]
 [14.06784449]
 [12.65667721]
 [20.44642591]
 [36.8511948 ]
 [18.23915704]
 [15.68059195]
 [27.94227689]
 [33.72178844]
 [25.87417863]
 [23.71753878]
 [30.06977403]
 [33.49939263]
 [12.90276399]
 [21.77636733]
 [13.46839484]
 [27.58062837]
 [38.71763499]
 [16.8653645 ]
 [18.97085148]
 [24.50668748]
 [21.702396  ]
 [14.12234433]
 [26.95312469]
 [22.896157  ]
 [27.88255367]
 [26.0658506 ]
 [25.86519933]
 [23.15052411]
 [15.77709093]
 [30.28372968]
 [32.36594419]
 [22.6454296 ]
 [21.92047491]
 [24.90030051]
 [33.18127914]
 [34.47799469]
 [17.77716652]
 [34.43253183]
 [28.6924788 ]
 [ 4.44015824]
 [23.80506518]
 [31.15432676]
 [16.47806836]
 [17.09123765]
 [21.78102479]
 [20.97238307]
 [13.55591488]
 [25.11605651]
 [11.83965144]
 [ 9.70448515]
 [18.19990418]
 [22.74290671]
 [25.68957154]
 [34.64953055]
 [ 9.13820728]
 [35.76559528]
 [23.13739738]
 [21.43910008]]
岭回归误差： 22.43885249537176
```

